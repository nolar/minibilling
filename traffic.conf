#!/bin/sh
#
# (a) 2006 nolar@numeri.net
#
# Файл настроек для скриптов сбора трафика и заброски его в базу данных.
# Этот файл передается всем таким скриптам первым обязательным параметром.
#
# Под текущим (обрабатываемым) интерфейсом в текстах комментариев понимается интерфейс,
# для которого составлен этот конфигурационный файл. Практически, единственный параметр,
# который задает связь с реальным интерфейсом системы - это ngipacct_node. Все остальные
# идентификаторы интерфейса являются лишь вспомогательными и используются для отличения
# файлов с трафиком или строк в базе данных, собранных с разных интерфейсов, и могут
# иметь значения, вообще не связанные с реальным системным именем интерфейса, или даже
# совпадающие с идентификаторами других интерфейсов (но последствия таких совпадений
# не изучены и потому непредсказуемы).
#

####################################################################################################
###                                   ПУТИ К КАТАЛОГАМ СИСТЕМЫ                                   ###
####################################################################################################

#
# Путь к каталогу, в котором будут создаваться все глобальные lock-файлы, и благодаря
# которым не возникнет нескольких параллельных процессов одного типа на один и тот же
# интерфейс. Имена lock-файлов составляются из имени скрипта (жестко вшитого, а не
# вычисляемого из имени файла скрипта), имени интерфейса, для которого производится
# работа и имеют расширение .lock. Lock-файлы после работы по возможности не удаляются.
# Фактически lock'инг происходит на уровне ядра. Читать lockf(1), flock(2).
#
lckdir="/data/traffic/lck"

#
# Путь к каталогу, где будут создаваться временные файлы с трафиком. В эти файлы будет
# складываться информация о трафике в процессе ее извлечения из коллектора. Когда
# извлечение заканчивается, эти файлы будут перенесены в каталог newdir или qmadir.
# Все временные файлы с трафиком имеют расширение .temp, а итоговые - .data. Таким
# образом, накладок не происходит, а tmpdir и newdir могут быть одним и тем же каталогом.
#
tmpdir="/data/traffic/tmp"

#
# Путь к каталогу, где будут создаваться вспомогательные файлы при заброске трафика в
# базу данных. Обычно это файлы SQL-запросов. Все файлы после успешного выполнения
# скриптов удаляются. А в случае возникновения ошибок, как правило, остаются для
# дальнейшего ихи анализа и выявления причин ошибок. Удалять такие файлы нужно вручную,
# либо используя системные механизмы очистки старых файлов. Если эти файлы не удалять,
# а каталог регулярно не проверять на чистоту, то со временем возможно захламление
# каталога и, как следствие, утечка дисковых ресурсов (места и i-nodes).
#
sqldir="/data/traffic/sql"

#
# Путь к каталогу, в который будут складываться упакованные архивы с файлами трафика.
# Все файлы в каталоге имеют имя, составленное из даты-времени упаковки файлов, имени
# интерфейса и имеют расширение .tar или .tar.gz. В один архив помещаются файлы любого
# направления трафика и любого времени создания, если они принадлежат обрабатываемому
# интерфейсу и находятся в olddir на момент создания архива.
#
pakdir="/data/traffic/pak"

#
# Путь к каталогу, где будут храниться файлы собранного, но не внесенного в базу трафика.
# Все файлы в каталоге имеют имя, составленное из даты-времени сбора трафика, имени
# интерфейса, направления (i - входящий, o - исходящий) и pid процесса, их создавшего.
# Ни в коем случае не должен совпадать с olddir, иначе возможен повторный заброс трафика!
#
newdir="/data/traffic/new"

#
# Путь к каталогу, где будут храниться файлы собранного и уже внесенного в базу трафика.
# Все файлы в каталоге имеют имя, составленное из даты-времени сбора трафика, имени
# интерфейса, направления (i - входящий, o - исходящий) и pid процесса, их создавшего.
# Ни в коем случае не должен совпадать с newdir, иначе возможен повторный заброс трафика!
#
olddir="/data/traffic/old"

####################################################################################################
###                                  МЕХАНИЗМЫ ПОВЕДЕНИЯ СИСТЕМЫ                                 ###
####################################################################################################

#
# Уникальный идентификатор интерфейса при составлении имен файлов.
# Учавствует в составлении имен всех файлов, которые так или иначе касаются обработки
# трафика с этого интерфейса. Желательно его делать в точности соответствующим имени
# интерфейса в системе, хотя это и не обязательное требование. Главное, что если вы
# делаете этот идентификатор отличным от системного имени интерфейса, то не забудьте
# задать правильное значения для переменной ngipacct_node.
#
identifier=""

#
# Забрасывать ли трафик в базу сразу же после его сборки с коллектора.
# Для включения введите yes/true/on/1 в любых регистрах. Для отключения - no/false/off/0.
#
autoinject="no"

#
# Обрабатывать ли трафик в базе сразу же после его заброски туда.
# Для включения введите yes/true/on/1 в любых регистрах. Для отключения - no/false/off/0.
#
autohandle="no"

#
# Файл, в котором будут храниться промежуточная информация между вызовами
# qmailanalog/matchup. Если файла не существует, то он будет создан. Так или иначе,
# а права на оперирование файлами в каталоге с этим файлом скрипт должен иметь.
#
qmailhistory="/data/traffic/qmail.history"

####################################################################################################
###                                 ПАРАМЕТРЫ СОБИРАЕМОГО ТРАФИКА                                ###
####################################################################################################

#
# Уникальный идентификатор интерфейса при заборске трафика в базу данных.
# Присваивается всему трафику, который удалось снять с этого интерфейса. Желательно
# чтобы все интерфейсы при заброске в базу имели разные числовые коды. Тогда возможен
# дальнейший анализ трафика по интерфейсам. Если трафик снимается с одного-единственного
# интерфейса в системе, либо если трафик с разных интерфейсов закидывается в разные базы,
# то этот параметр не играет никакой особой роли (но должен быть задан).
# Должен иметь значение, допустимое для соответствующей колонки в базе. Обычно 0-255.
# Возможно использование и строкового идентификатора, но так делать не рекомендуется.
#
interface="0"

####################################################################################################
###                                 НАСТРОЙКИ ВЫЗЫВАЕМЫХ ПРОГРАММ                                ###
####################################################################################################

#
# Имя узла для ipacctctl(8). Обычно состоит из имени узла netgraph типа ipacct,
# с которого мы снимаем трафик, и префикса hook'ов этого узла. Может быть и по-другому.
# Реальное значение этого параметра зависит от способа внедрения и запуска ngipacct.
#
ngipacct_node="-"

#
# Файл с параметрами подключения к базе и серверу MySQL. Там рекомендуется указывать
# адрес сервера и порт подключения, имя и пароль пользователя для входа на сервер,
# имя базы для собранного трафика и прочие параметры работы клиента mysql(1).
#
mysql_config="/etc/traffic.my.cnf"

####################################################################################################
###                                             ВСЕ.                                             ###
####################################################################################################
